name: Triggered Workflow

on:
  workflow_dispatch:
    inputs:
      customer_full_name:
        description: "Customer full name"
        type: string
        required: true
      email:
        description: "Email"
        type: string
        required: true
      image_deployment_type:
        description: "Customer image deployment type"
        type: string
        required: true
      customer_public_facing_ips:
        description: "Customer public facing IPs"
        type: string
        required: true
      mssp_access:
        description: "MSSP access"
        type: string
        required: true

jobs:
  triggered_job:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Run triggered action
        run: |
          echo "Workflow triggered from Zapier!"
          echo "Customer Full Name: ${{ github.event.inputs.customer_full_name }}"
          echo "Email: ${{ github.event.inputs.email }}"
          echo "Image Deployment Type: ${{ github.event.inputs.image_deployment_type }}"
          echo "Customer Public Facing IPs: ${{ github.event.inputs.customer_public_facing_ips }}"
          echo "MSSP Access: ${{ github.event.inputs.mssp_access }}"

  echo_time_trigger:
    runs-on: ubuntu-latest
    needs: triggered_job  # Ensure this runs after the triggered_job
    steps:
      - name: Trigger Echo Time Workflow
        uses: actions/github-script@v6
        with:
          script: |
            const workflow_id = 'echo-time.yaml';  // Name of the workflow file
            const ref = 'main'; // Branch to run the workflow on
            await github.actions.createWorkflowDispatch({
              owner: context.repo.owner,
              repo: context.repo.repo,
              workflow_id,
              ref,
              inputs: {} // Pass any necessary inputs here if needed
            });
